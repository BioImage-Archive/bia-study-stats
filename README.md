# BIA Study Statistics

A command-line tool for analyzing and visualizing BioImage Archive (BIA) study statistics.

## Installation

Clone this repository and install dependencies:
```bash
git clone https://github.com/bioimage-archive/bia-study-stats.git
cd bia-study-stats
pip install -e .
```

## Commands

### View Study Information

- `print_accessions`: Display a table of accession IDs and their sizes
  ```bash
  bia-study-stats print_accessions stats.json
  ```

- `summarize`: Show summary statistics including total accessions and storage usage
  ```bash
  bia-study-stats summarize stats.json
  ```

### Update Size Information

- `merge_df_sizes`: Merge size information from a `df` command output file
  ```bash
  bia-study-stats merge_df_sizes stats.json df_output.txt
  ```

- `merge_s3_cache`: Update sizes using an S3 cache file
  ```bash
  bia-study-stats merge_s3_cache stats.json s3_cache.json
  ```

- `update_from_fire`: Fetch sizes directly from S3/FIRE storage for studies with zero size
  ```bash
  bia-study-stats update_from_fire stats.json --failed-log errors.log
  ```

### Analysis and Visualization

- `data_added_after`: Calculate total data volume added after a specific date
  ```bash
  bia-study-stats data_added_after stats.json 2023-01-01
  ```

- `plot_cumulative_size`: Generate a bar chart showing cumulative data size by quarter
  ```bash
  bia-study-stats plot_cumulative_size stats.json
  ```

- `plot_cumulative_entries`: Create a bar chart of cumulative study count by quarter
  ```bash
  bia-study-stats plot_cumulative_entries stats.json
  ```

- `print_ebi_stats`: Output monthly cumulative size statistics in EBI format
  ```bash
  bia-study-stats print_ebi_stats stats.json
  ```

## Configuration

For commands that interact with S3/FIRE storage, create a `.env` file with:

```
S3_BUCKET=your-bucket-name
S3_ENDPOINT=https://your-endpoint.com  # Optional
AWS_PROFILE=your-profile  # Optional
```

## Output Files

- `quarterly_cumulative_size.png`: Generated by `plot_cumulative_size`
- `quarterly_cumulative_entries.png`: Generated by `plot_cumulative_entries`
